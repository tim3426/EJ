SELECT
C.NAME
,[ADDSAL].PRIMARYSALUTATION [Salutation]
,C.LookupID as [Lookup ID]
,C.Age
,C.City
,C.State
,case when [Do Not Call].ID is null then C.PHONE else null end as [PHONE]
,case when [Do Not Email].ID is null then C.EMAIL else null end as [EMAIL]
,I.OBJECTIVE as [Summary]
,I.EXPECTEDDATE as [Expected Date]
,I.CATEGORY_TRANSLATION as [Category]
,I.SUBCATEGORY_TRANSLATION as [Subcategory]
,I.CONTACTMETHOD as [Contact Method]
,O.Name as [Owner]
,O.ID as [Owner Record ID]
,C.CONSTITUENTID as [Constituent Record ID]
,OTEAM.BUSINESSUNIT as [Team]
,case when [I].[PROSPECTPLANID] is not null then 'True'
else 'False' end as [Ismove]
,I.ID as [Interaction Record ID]




FROM V_QUERY_INTERACTIONALL I 
LEFT OUTER JOIN V_QUERY_CONSTITUENT [O] ON [O].ID = I.OWNERID
LEFT OUTER JOIN (
	SELECT
		[CONSTITUENT].[ID] [CONSTITUENTID],
		[DBO].[UFN_BUSINESSUNITCODE_GETDESCRIPTION](ORGANIZATIONPOSITION.BUSINESSUNITCODEID) [BUSINESSUNIT]
	FROM [DBO].[ORGANIZATIONHIERARCHY]
	INNER JOIN DBO.ORGANIZATIONPOSITION ON ORGANIZATIONPOSITION.ID = ORGANIZATIONHIERARCHY.ID
	LEFT OUTER JOIN DBO.ORGANIZATIONPOSITIONHOLDER ON ORGANIZATIONPOSITIONHOLDER.POSITIONID = ORGANIZATIONPOSITION.ID
	LEFT OUTER JOIN DBO.CONSTITUENT ON CONSTITUENT.ID = ORGANIZATIONPOSITIONHOLDER.CONSTITUENTID
	WHERE ORGANIZATIONPOSITIONHOLDER.DATETO IS NULL
	) [OTEAM] ON O.[ID] = OTEAM.[CONSTITUENTID]

LEFT OUTER JOIN EJ_CONSTITUENT_HISTORY as C on [C].[CONSTITUENTID] = I.CONSTITUENTID
LEFT OUTER JOIN V_QUERY_ADDRESSEE_SALUTATION as [ADDSAL] on [C].[CONSTITUENTID] = [ADDSAL].[ID]
LEFT OUTER JOIN dbo.[UFN_ADHOCQUERYIDSET_F524CA2C_5E71_47ED_9049_71C79D1226F7]() as [Do Not Contact] on [C].[CONSTITUENTID] = [Do Not Contact].ID
LEFT OUTER JOIN dbo.[UFN_ADHOCQUERYIDSET_71B9837E_32F7_4D66_BBAC_53A36F3731F9]() as [Do Not Call] on [C].[CONSTITUENTID] = [Do Not Call].ID
LEFT OUTER JOIN dbo.[UFN_ADHOCQUERYIDSET_8367E7CC_AEA4_4C6A_B9D0_3CC48D753C9D]() as [Do Not Email] on [C].[CONSTITUENTID] = [Do Not Email].ID

WHERE I.STATUS = 'Pending'
AND C.DECEASED = 0 and C.INACTIVE = 0 
AND [Do Not Contact].ID is null
AND OTEAM.BUSINESSUNIT = 'Planned gifts'
AND I.EXPECTEDDATE BETWEEN DATEADD(MONTH,-3,GETDATE()) AND DATEADD(MONTH,3,GETDATE())